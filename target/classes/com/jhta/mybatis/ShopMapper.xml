<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jhta.mybatis.ShopMapper">

<select id="classlist"  resultType="shopclassvo">
	select * from class
</select>

<select id="fieldlist"  parameterType="int" resultType="shopfieldvo">
select * from item where fieldnum=#{fieldnum}
</select>

<select id="fieldcnt" parameterType="int" resultType="int">
select NVL(count(*),0) from field where classnum=#{classnum}
</select>

<select id="classitemlist" parameterType="hashmap" resultType="shopitemvo">
select * from (select aa.*,rownum rnum from (select * from item where fieldnum in(select fieldnum from field where classnum in(select classnum from class where classnum=#{classnum} )))aa) <![CDATA[where rnum >=#{startRow} and rnum <=#{endRow} order by p_num desc]]>
 			
</select>

<select id="classcnt" parameterType="int" resultType="int">
select NVL(count(*),0) from item where fieldnum in(select fieldnum from field where classnum in(select classnum from class where classnum=#{classnum} ))
</select>

<select id="fielditemlist" parameterType="hashmap" resultType="shopitemvo">
select * from (select * from (select aa.*,rownum rnum from (select * from item where  fieldnum = #{fieldnum})aa)) <![CDATA[where rnum >=#{startRow} and rnum <=#{endRow} order by p_num desc]]>
</select>

<select id="itemlist" parameterType="hashmap" resultType="shopitemvo">
select * from (select aa.*,rownum rnum from (select * from item)aa 
<where>
<if test="fc_num=='0'">
fieldnum = #{fieldnum}) <![CDATA[where rnum >=#{startRow} and rnum <=#{endRow} order by p_num desc]]>
</if>

<if test="fc_num!=null and fc_num!='0'"> 
fieldnum in #{fieldnum} and p_num in (select p_num from itemfilter where fc_num in(select fc_num from filtercontent where ${sql}))) <![CDATA[where rnum >=#{startRow} and rnum <=#{endRow} order by p_num desc]]>
</if>

</where>
</select>

<select id="itemcnt" parameterType="hashmap" resultType="int">
select NVL(count(*),0) cnt from item 	
<where>
<if test="fc_num=='0'">
fieldnum = #{fieldnum}
</if>
			
<if test="fc_num!=null and fc_num!='0'"> 
fieldnum in #{fieldnum} and p_num in (select p_num from itemfilter where fc_num in(select fc_num from filtercontent where ${sql}))
</if>

</where>
</select>


<select id="filtertype" parameterType="Integer"  resultType="shopfiltertypevo">
select * from filtertype where ft_num in(select ft_num from filtercontent where fc_num in(select fc_num from itemfilter where p_num in(select p_num from item where fieldnum in(select fieldnum from field where fieldnum=#{fieldnum}))))
</select>

<select id="filtercontent" parameterType="Integer" resultType="shopfiltercontentvo">
select * from filtercontent where ft_num =#{ft_num}
</select>

<select id="iteminfo" parameterType="Integer" resultType="shopitemvo">
select * from item where p_num=#{p_num}
</select>

<select id="itemreview" parameterType="Integer" resultType="shopitemreviewvo">
select * from itemreview where p_num=#{p_num}
</select>

<select id="imglist"  parameterType="Integer" resultType="shopitemimagevo">
select * from itemimage where p_num=#{p_num}
</select>

<insert id="payinsert" parameterType="payboardvo">
insert into payboard values(seq_payboard_buy_num.nextval,sysdate,#{name},#{addr},#{caddr},#{accprice},#{m_email})
</insert>

<select id="getbuynum" resultType="int">
select max(buy_num) from payboard
</select>

<insert id="orderinsert" parameterType="orderitemlistvo">
insert into orderitemlist values(seq_orderitemlist_order_num.nextval,#{amount},#{price},#{p_num},#{buy_num})
</insert>

</mapper>

